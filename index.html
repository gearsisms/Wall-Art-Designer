<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Wall Art Designer</title>
  <style>
    * { margin:0; padding:0; box-sizing:border-box; -webkit-tap-highlight-color:transparent; }
    body { font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,'Helvetica Neue',Arial,sans-serif;
           background:#2a2a2a; color:#e0e0e0; display:flex; flex-direction:column; align-items:center;
           min-height:100vh; padding:20px 10px; position:relative; overflow-x:hidden; touch-action:manipulation; }
    @media (min-width:768px){ body{padding:40px 20px;} }

    .wall-count-btn{position:absolute;top:20px;right:20px;background:#3a3a3a;color:#e0e0e0;
                    border:1px solid #4a4a4a;padding:8px 16px;font-size:.85rem;font-weight:400;
                    border-radius:6px;cursor:pointer;transition:all .2s;letter-spacing:.3px;z-index:100;}
    @media (min-width:768px){.wall-count-btn{top:40px;right:40px;padding:10px 24px;font-size:.9rem;}}
    .wall-count-btn:hover{background:#4a4a4a;border-color:#5a5a5a;}
    .wall-count-btn:active{transform:scale(.98);}

    .modal-overlay{display:none;position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,.7);
                    z-index:1000;justify-content:center;align-items:center;}
    .modal-overlay.active{display:flex;}
    .modal{background:#3a3a3a;border:1px solid #4a4a4a;border-radius:8px;padding:30px;max-width:500px;
           width:90%;max-height:80vh;overflow-y:auto;box-shadow:0 8px 32px rgba(0,0,0,.6);}
    .modal-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;
                  padding-bottom:15px;border-bottom:1px solid #4a4a4a;}
    .modal-title{font-size:1.5rem;font-weight:300;color:#fff;}
    .close-btn{background:none;border:none;color:#b0b0b0;font-size:1.5rem;cursor:pointer;padding:0;
               width:30px;height:30px;display:flex;align-items:center;justify-content:center;transition:color .2s;}
    .close-btn:hover{color:#fff;}
    .wall-list{display:grid;grid-template-columns:repeat(2,1fr);gap:12px;}
    .wall-item{background:#2a2a2a;padding:12px 16px;border-radius:6px;border:1px solid #4a4a4a;
               display:flex;justify-content:space-between;align-items:center;}
    .th-label{font-weight:400;color:#b0b0b0;}
    .wall-value{font-weight:500;color:#4CAF50;}

    h1{font-size:1.75rem;font-weight:300;letter-spacing:-1px;margin-bottom:20px;color:#fff;text-align:center;}
    @media (min-width:768px){h1{font-size:2.5rem;margin-bottom:40px;}}
    .controls{display:flex;flex-direction:column;align-items:center;gap:15px;margin-bottom:20px;width:100%;max-width:500px;}
    @media (min-width:768px){.controls{gap:20px;margin-bottom:30px;}}
    .info-text{font-size:.85rem;color:#b0b0b0;font-weight:300;text-align:center;padding:0 10px;}
    @media (min-width:768px){.info-text{font-size:.95rem;}}
    .button-group{display:flex;gap:10px;flex-wrap:wrap;justify-content:center;}
    @media (min-width:768px){.button-group{gap:12px;}}
    button{background:#3a3a3a;color:#e0e0e0;border:1px solid #4a4a4a;padding:8px 20px;font-size:.85rem;
           font-weight:400;border-radius:6px;cursor:pointer;transition:all .2s;letter-spacing:.3px;
           touch-action:manipulation;}
    @media (min-width:768px){button{padding:10px 24px;font-size:.9rem;}}
    button:hover{background:#4a4a4a;border-color:#5a5a5a;}
    button:active{transform:translateY(1px);}
    .counter{font-size:.9rem;color:#fff;font-weight:300;padding:8px 16px;background:#3a3a3a;
             border-radius:6px;border:1px solid #4a4a4a;}
    @media (min-width:768px){.counter{font-size:1rem;padding:8px 20px;}}
    .counter span{font-weight:500;color:#4CAF50;}
    #gridCanvas{border:none;background:transparent;max-width:100%;max-height:70vh;touch-action:none;}
    @media (min-width:768px){#gridCanvas{max-height:none;}}
  </style>
</head>
<body>
  <button class="wall-count-btn" id="wallCountBtn">Wall Count</button>

  <div class="modal-overlay" id="modalOverlay">
    <div class="modal">
      <div class="modal-header">
        <h2 class="modal-title">Wall Count by Town Hall</h2>
        <button class="close-btn" id="closeModal">x</button>
      </div>
      <div class="wall-list">
        <div class="wall-item"><span class="th-label">TH 1</span><span class="wall-value">0</span></div>
        <div class="wall-item"><span class="th-label">TH 2</span><span class="wall-value">25</span></div>
        <div class="wall-item"><span class="th-label">TH 3</span><span class="wall-value">50</span></div>
        <div class="wall-item"><span class="th-label">TH 4</span><span class="wall-value">75</span></div>
        <div class="wall-item"><span class="th-label">TH 5</span><span class="wall-value">100</span></div>
        <div class="wall-item"><span class="th-label">TH 6</span><span class="wall-value">125</span></div>
        <div class="wall-item"><span class="th-label">TH 7</span><span class="wall-value">175</span></div>
        <div class="wall-item"><span class="th-label">TH 8</span><span class="wall-value">225</span></div>
        <div class="wall-item"><span class="th-label">TH 9</span><span class="wall-value">250</span></div>
        <div class="wall-item"><span class="th-label">TH 10</span><span class="wall-value">275</span></div>
        <div class="wall-item"><span class="th-label">TH 11</span><span class="wall-value">300</span></div>
        <div class="wall-item"><span class="th-label">TH 12</span><span class="wall-value">300</span></div>
        <div class="wall-item"><span class="th-label">TH 13</span><span class="wall-value">300</span></div>
        <div class="wall-item"><span class="th-label">TH 14</span><span class="wall-value">325</span></div>
        <div class="wall-item"><span class="th-label">TH 15</span><span class="wall-value">325</span></div>
        <div class="wall-item"><span class="th-label">TH 16</span><span class="wall-value">325</span></div>
        <div class="wall-item"><span class="th-label">TH 17</span><span class="wall-value">325</span></div>
      </div>
    </div>
  </div>

  <h1>Wall Art Designer</h1>
  <div class="controls">
    <p class="info-text">Click on the grid to toggle cells and create your design</p>
    <div class="button-group">
      <button id="undoButton">Undo</button>
      <button id="resetGrid">Reset Grid</button>
    </div>
    <div class="counter">Filled cells: <span id="cellCounter">0</span></div>
  </div>

  <canvas id="gridCanvas" width="600" height="600"></canvas>

  <script>
    // ------------------------------------------------------------
    //  Grid configuration
    // ------------------------------------------------------------
    const SIZE   = 45;
    const CENTER = (SIZE-1)/2;
    const squareMask = Array.from({length:SIZE},()=>Array.from({length:SIZE},()=>true));

    const canvas = document.getElementById('gridCanvas');
    const ctx    = canvas.getContext('2d');

    // ------------------------------------------------------------
    //  Rendering
    // ------------------------------------------------------------
    function renderGrid(grid){
      ctx.clearRect(0,0,canvas.width,canvas.height);

      const minDim   = Math.min(canvas.width,canvas.height);
      const cellSize = minDim / (SIZE * Math.SQRT2);
      const originX  = canvas.width/2;
      const originY  = canvas.height/2;

      // Perspective tilt (30° vertical like CoC)
      ctx.save();
      ctx.translate(originX,originY);
      ctx.scale(1,0.866);
      ctx.translate(-originX,-originY);

      const halfGrid = (SIZE*cellSize)/Math.SQRT2;

      // Background diamond
      ctx.save();
      ctx.shadowColor='rgba(0,0,0,.5)'; ctx.shadowBlur=25; ctx.shadowOffsetY=6;
      ctx.fillStyle='#d4f1d4';
      ctx.beginPath();
      ctx.moveTo(originX,originY-halfGrid);
      ctx.lineTo(originX+halfGrid,originY);
      ctx.lineTo(originX,originY+halfGrid);
      ctx.lineTo(originX-halfGrid,originY);
      ctx.closePath(); ctx.fill();
      ctx.restore();

      // Border highlights
      const bw=3;
      ctx.save();
      ctx.strokeStyle='rgba(0,0,0,.4)'; ctx.lineWidth=bw;
      ctx.beginPath(); ctx.moveTo(originX+halfGrid,originY);
      ctx.lineTo(originX,originY+halfGrid); ctx.lineTo(originX-halfGrid,originY); ctx.stroke();
      ctx.strokeStyle='rgba(255,255,255,.3)';
      ctx.beginPath(); ctx.moveTo(originX-halfGrid,originY);
      ctx.lineTo(originX,originY-halfGrid); ctx.lineTo(originX+halfGrid,originY); ctx.stroke();
      ctx.restore();

      // Draw each diamond cell
      for(let row=0;row<SIZE;row++){
        for(let col=0;col<SIZE;col++){
          if(!squareMask[row][col]) continue;
          const filled = grid[row][col]===1;

          const gridX = col - SIZE/2 + 0.5;
          const gridY = row - SIZE/2 + 0.5;

          const cx = originX + (gridX*Math.SQRT1_2 - gridY*Math.SQRT1_2)*cellSize;
          const cy = originY + (gridX*Math.SQRT1_2 + gridY*Math.SQRT1_2)*cellSize;
          const hc = cellSize/2;

          ctx.fillStyle = filled ? '#000' : '#d4f1d4';
          ctx.beginPath();
          ctx.moveTo(cx - hc*Math.SQRT1_2 + hc*Math.SQRT1_2, cy - hc*Math.SQRT1_2 - hc*Math.SQRT1_2);
          ctx.lineTo(cx + hc*Math.SQRT1_2 + hc*Math.SQRT1_2, cy + hc*Math.SQRT1_2 - hc*Math.SQRT1_2);
          ctx.lineTo(cx + hc*Math.SQRT1_2 - hc*Math.SQRT1_2, cy + hc*Math.SQRT1_2 + hc*Math.SQRT1_2);
          ctx.lineTo(cx - hc*Math.SQRT1_2 - hc*Math.SQRT1_2, cy - hc*Math.SQRT1_2 + hc*Math.SQRT1_2);
          ctx.closePath(); ctx.fill();

          if(!filled){
            ctx.strokeStyle='#b8e6b8'; ctx.lineWidth=.5; ctx.stroke();
          }
        }
      }
      ctx.restore();
    }

    // ------------------------------------------------------------
    //  Hit-testing (mouse / touch → grid cell)
    // ------------------------------------------------------------
    function hitTestDiamond(px,py){
      const minDim   = Math.min(canvas.width,canvas.height);
      const cellSize = minDim / (SIZE * Math.SQRT2);
      const originX  = canvas.width/2;
      const originY  = canvas.height/2;

      // Undo perspective scale
      let tx = px - originX;
      let ty = (py - originY) / 0.866;
      tx += originX; ty += originY;

      const dx = tx - originX;
      const dy = ty - originY;

      const gridX = (dx*Math.SQRT1_2 + dy*Math.SQRT1_2)/cellSize;
      const gridY = (-dx*Math.SQRT1_2 + dy*Math.SQRT1_2)/cellSize;

      const col = Math.floor(gridX + SIZE/2);
      const row = Math.floor(gridY + SIZE/2);

      if(row<0||row>=SIZE||col<0||col>=SIZE) return null;
      if(!squareMask[row][col]) return null;
      return [row,col];
    }

    // ------------------------------------------------------------
    //  Coordinate conversion (mouse/touch → canvas pixels)
    // ------------------------------------------------------------
    function getEventPos(evt){
      const rect = canvas.getBoundingClientRect();
      let clientX, clientY;
      if(evt.touches && evt.touches.length) { clientX=evt.touches[0].clientX; clientY=evt.touches[0].clientY; }
      else if(evt.changedTouches && evt.changedTouches.length) { clientX=evt.changedTouches[0].clientX; clientY=evt.changedTouches[0].clientY; }
      else { clientX=evt.clientX; clientY=evt.clientY; }

      const x = (clientX - rect.left) * (canvas.width  / rect.width);
      const y = (clientY - rect.top)  * (canvas.height / rect.height);
      return {x,y};
    }

    // ------------------------------------------------------------
    //  Grid state & UI
    // ------------------------------------------------------------
    let userGrid = Array.from({length:SIZE},()=>Array.from({length:SIZE},()=>0));
    const history = []; const MAX_HISTORY = 50;

    function saveHistory(){ history.push(userGrid.map(r=>[...r])); if(history.length>MAX_HISTORY) history.shift(); }
    function countFilled(){ let c=0; for(let r of userGrid) for(let v of r) if(v===1) c++; return c; }
    function updateCounter(){ document.getElementById('cellCounter').textContent = countFilled(); }
    function updateDisplay(){ renderGrid(userGrid); updateCounter(); }

    // Drawing state
    let isDrawing = false, drawingValue = 1, changedThisStroke = false;

    function start(evt){
      evt.preventDefault();
      const {x,y} = getEventPos(evt);
      const cell = hitTestDiamond(x,y);
      if(!cell) return;
      const [row,col] = cell;
      saveHistory(); changedThisStroke = false;
      drawingValue = userGrid[row][col] ? 0 : 1;
      userGrid[row][col] = drawingValue; changedThisStroke = true;
      isDrawing = true; updateDisplay();
    }
    function move(evt){
      if(!isDrawing) return;
      evt.preventDefault();
      const {x,y} = getEventPos(evt);
      const cell = hitTestDiamond(x,y);
      if(!cell) return;
      const [row,col] = cell;
      if(userGrid[row][col] !== drawingValue){ userGrid[row][col]=drawingValue; changedThisStroke=true; updateDisplay(); }
    }
    function end(){
      if(isDrawing && !changedThisStroke && history.length) history.pop();
      isDrawing = false;
    }

    canvas.addEventListener('mousedown',start);
    canvas.addEventListener('mousemove',move);
    window.addEventListener('mouseup',end);
    canvas.addEventListener('mouseleave',end);

    canvas.addEventListener('touchstart', start, {passive:false});
    canvas.addEventListener('touchmove',  move,  {passive:false});
    canvas.addEventListener('touchend',   end);
    canvas.addEventListener('touchcancel',end);

    document.getElementById('resetGrid').addEventListener('click',()=>{
      saveHistory(); userGrid = Array.from({length:SIZE},()=>Array.from({length:SIZE},()=>0));
      updateDisplay();
    });
    document.getElementById('undoButton').addEventListener('click',()=>{
      if(history.length){ userGrid = history.pop(); updateDisplay(); }
    });

    // Modal
    const modal = document.getElementById('modalOverlay');
    document.getElementById('wallCountBtn').addEventListener('click',()=>modal.classList.add('active'));
    document.getElementById('closeModal').addEventListener('click',()=>modal.classList.remove('active'));
    modal.addEventListener('click',e=>{ if(e.target===modal) modal.classList.remove('active'); });

    // Initial draw
    updateDisplay();
  </script>
</body>
</html>
